<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="room">
	<!-- 룸 리스트  -->
 	<select id="selectAllRoom" parameterType="_int" resultType="r">
 		select
 			room_no as roomNo,
 			house_no as houseNo,
 			room_title as roomTitle,
 			room_size as roomSize,
 			room_phone as roomPhone,
 			room_status as roomStatus,
 			room_charge as roomCharge,
 			room_content as roomContent,
 			room_personnel as roomPersonnel,
 			room_month as roomMonth
 		from room where house_no=#{houseNo}
 	</select>
 	<!-- 룸 등록 -->
 	<insert id="insertRoom" parameterType="r">
 		insert into room
 		values(room_seq.nextval,#{houseNo},#{roomTitle},#{roomSize},#{roomPhone},1,#{roomCharge},#{roomContent},#{roomPersonnel},#{roomMonth})
 	</insert>
 	<!-- 룸 삭제  -->
 	<delete id="deleteRoom" parameterType="r">
 		delete from room where room_no=#{roomNo} and house_no=#{houseNo}
 	</delete>
 	<select id="selectOneRoom" parameterType="map" resultType="r">
 		select
 			room_no as roomNo,
 			house_no as houseNo,
 			room_title as roomTitle,
 			room_size as roomSize,
 			room_phone as roomPhone,
 			room_status as roomStatus,
 			room_charge as roomCharge,
 			room_content as roomContent,
 			room_personnel as roomPersonnel,
 			room_month as roomMonth
 		from room where house_no=#{houseNo} and room_no=#{roomNo}
 	</select>
 	<update id="updateRoom" parameterType="r">
 		update room set 
 		room_title = #{roomTitle},
 		room_size = #{roomSize},
 		room_phone = #{roomPhone},
 		room_charge = #{roomCharge},
 		room_content = #{roomContent},
 		room_personnel = #{roomPersonnel},
 		room_month = #{roomMonth}
 		where room_no=#{roomNo} and house_no=#{houseNo}
 	</update>
 	<select id="selectHouseOwnerList" parameterType="_int" resultType="h">
 	select
 		house_no as houseNo,
 		member_no as memberNo,
 		house_title as houseTitle,
 		houseowner_deadline as houseownerDeadline,
 		house_selling as houseSelling,
 		refuse_reason as refuseReason,
 		house_content as houseContent,
 		house_room as houseRoom,
 		house_charge as houseCharge,
 		house_rule as houseRule,
 		house_form as houseForm,
 		house_gender as houseGender,
 		house_convenience as houseConvenience
 		house_allow as houseAllow
 	from house where member_no = #{memberNo}
 	</select>
 	<!-- 입주신청 sowon -->
 	<insert id="insertMove" parameterType="map">
 	insert into move
  	values(
  		move_seq.nextval,
  		#{roomNo},
  		#{memberNo},
  		#{m.moveStart},
  		#{m.moveEnd},
  		#{m.movePhone}
  	)
 	</insert>
 	<!-- room 상태변경  -->
 	<update id="updateHouseRoom" parameterType="map">
 		update room set room_status=2 where room_no=#{roomNo} and house_no=#{houseNo}
 	</update>
 	<!-- 결제정보 등록 -->
 	<insert id="insertMovePay" parameterType="map">
 		insert into pay
	  	values(
	  		pay_seq.nextval,
	  		2,
	  		#{roomNo},
	  		#{p.payId},
	  		#{p.payName},
	  		#{p.payNum},
	  		#{p.payPrice},
	  		to_char(sysdate,'YYYY-MM-DD HH24:MI:SS'),
	  		#{p.payWay},
	  		'결제완료',
	  		null
	  	)	
 	</insert>
 	<!-- 입주 등록시 하우스 내용가져오기 -->
 	<select id="houseOneSelect" parameterType="_int" resultType="h">
 		select
			house_no as houseNo,
			member_no as memberNo,
			house_title as houseTitle,
			houseowner_deadline as houseownerDeadline,
			house_selling as houseSelling,
			refuse_reason as refuseReason,
			house_content as houseContent,
			house_room as houseRoom,
			house_charge as houseCharge,
			house_rule as houseRule,
			house_form as houseForm,
			house_gender as houseGender,
			house_convenience as houseConvenience,
			house_allow as houseAllow
            from house
		 where house_no = #{houseNo}
 	</select>
 	<!-- 잔여방 갯수 -->
 	<select id="selectRoomCount" parameterType="_int" resultType="_int">
 		select count(*)from room where house_no=#{houseNo} and room_status=2
 	</select>
 	<!-- 입주신청시 방이 꽉차면 하우스 셀링 번호 2로.. -->
 	<update id="updateHouseSelling" parameterType="_int">
 		update house set 
 			house_selling=2
 		where house_no = #{houseNo}
 	</update>
	<!-- 투어신청 리스트 -->
 	<select id="selectTourRequest" parameterType="map" resultType="t">
 		select
 			tour_no as tourNo,
 			room_no as roomNo,
 			member_no as memberNo,
 			tour_phone as tourPhone,
 			tour_email as tourEmail,
 			house_name as houseName,
 			tour_qna as tourQna,
 			tour_visit as tourVisit,
 			tour_status as tourStatus
 		from (select rownum as rnum, t.* from (SELECT * FROM tour where member_no=#{memberNo} order by 1 desc)t) 
		where rnum between #{start} and #{end}
 	</select>
 	<select id="tourRequestCount" parameterType="_int" resultType="_int">
 		select count(*) from tour where member_no = #{memberNo}
 	</select>

</mapper>
